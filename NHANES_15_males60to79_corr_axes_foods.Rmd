---
title: "Correlation between ordination axes and foods"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 3
# code_folding: hide
---

<style type="text/css">
h1.title {
  font-size: 38px;
  font-family: "Tahoma", sans-serif;
  color: #1F3600; /* darkgreen from DietDiveR logo */
}
h1 { /* Header 1 */
  font-size: 28px;
  color: #1F3600;
}
h2 { /* Header 2 */
    font-size: 22px;
  color: #1F3600;
}
h3 { /* Header 3 */
  font-size: 18px;
  color: #1F3600;
}
body{ /* Normal  */
  background-color: rgb(251, 251, 251);
  }
blockquote{ 
  font-size: 14px;
}
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    background-color: #1F3600;
}
</style>

<br>

# Introduction

In this script, we will analyze correlation between ordination axes values and foods.

<br>

# Load functions and packages  

Name the path to DietDiveR directory where input files are pulled.
```{r}
main_wd <- "~/GitHub/DietDiveR"
```

Load necessary packages.
```{r}
library(ggplot2)
```

Load the necessary functions.
```{r}
source("lib/specify_data_dir.R")
source("lib/corr.axes.foods.R")
source("lib/ggplot2themes.R")
```

Load the distinct 100 colors for use.
```{r}
distinct100colors <- readRDS("lib/distinct100colors.rda")
```

You can come back to the main directory by:
```{r, eval=FALSE}
setwd(main_wd)
```

Specify the directory where the data is.
```{r, eval=FALSE}
SpecifyDataDirectory(directory.name = "eg_data/NHANES/Laboratory_data/Ordination/")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_knit$set(root.dir = 'eg_data/NHANES/Laboratory_data/Ordination/')
```

<br>

# Weighted unifrac distance ordination results 
  
From sorted IFC table, generate a table of total amount of food consumed by all the individuals, and a table with correlation coefficients, p-values, and q-values with a desired threshold between food items and Axes that were saved in the ordination section. This function will print out the food items' names while calculating the correlation measures.

Be careful not to confuse WEIGHTED and UNweighted unifrac distances as you name the files.
```{r}
CorrAxesFood(food_ifc_soted = "../Foodtree/Food_D12_FC_QC_demo_QCed_males60to79_3Lv.food.ifc_sorted.txt", 
             AmountSums_out_fn =          "Food_D12_FC_QC_demo_QCed_males60to79_3Lv_AmountSums.txt",
             qval_threshold = 0.05,
             meta_users =            "Food_D12_FC_QC_demo_QCed_males60to79_3Lv_ord_WEIGHTED_meta_users.txt",
             corr_axes_foods_outfn = "Food_D12_FC_QC_demo_QCed_males60to79_3Lv_ord_WEIGHTED_corr_axes_foods_thr0.05.txt")
```

Argument | Description
------------------- | -----------------------------------
food_ifc_soted | xxx.food.ifc.sorted.txt file, saved in the ordination section
AmountSums_out_fn | Output filename to be saved which has the total consumption amount of each food
qval_threshold | q-value threshold to call a correlation significant
meta_users | xxx.meta_users.txt file, waved in the ordination section
corr_axes_foods_outfn | Output filename to be saved which has the correlation between foods and Axes

<br>

---

## Load and analyze the output

```{r}
dat <- read.delim("Food_D12_FC_QC_demo_QCed_males60to79_3Lv_ord_WEIGHTED_corr_axes_foods_thr0.05.txt")
```

Check the number of food items with significant q-values.
```{r}
nrow(subset(dat, Significance=="*"))
```

There are 31 food items correlated with particular food items.

Show only food items that are significantly correlated with one of the axes.
```{r}
subset(dat, Significance=="*")
```

It is also possible to view each axis separately.

```{r}
# Select Axis 1 rows
dat_1 <- subset(dat, Axis=="Axis.1")
head(dat_1[order(dat_1$qval), ], 10)
```

```{r}
# Select Axis 2 rows and sort by qval.  
dat_2 <- subset(dat, Axis=="Axis.2")
head(dat_2[order(dat_2$qval), ], 10)
```

```{r}
# Select Axis 3 rows and sort by qval.  
dat_3 <- subset(dat, Axis=="Axis.3")
head(dat_3[order(dat_3$qval), ], 10)
```

```{r}
# Select Axis 4 rows and sort by qval.  
dat_4 <- subset(dat, Axis=="Axis.4")
head(dat_4[order(dat_4$qval), ], 10)
```

<br>

# Unweighted unifrac distance ordination results

xxx_AmountSums.txt will be generated again, but its content will be the same regardless of which distance method (weighted or unweighted unifrac or else) was used, as long as the food.ifc_sorted is the same.

```{r}
CorrAxesFood(food_ifc_soted = "../Foodtree/Food_D12_FC_QC_demo_QCed_males60to79_3Lv.food.ifc_sorted.txt",
             AmountSums_out_fn = "Food_D12_FC_QC_demo_QCed_males60to79_3Lv_AmountSums.txt",
             qval_threshold = 0.05,
             meta_users =            "Food_D12_FC_QC_demo_QCed_males60to79_3Lv_ord_UNweighted_meta_users.txt",
             corr_axes_foods_outfn = "Food_D12_FC_QC_demo_QCed_males60to79_3Lv_ord_UNweighted_corr_axes_foods_thr0.05.txt")
```

<br>

---

## Load and analyze the output

UNweighted can be viewed in the same way.
```{r}
dat <- read.delim("Food_D12_FC_QC_demo_QCed_males60to79_3Lv_ord_UNweighted_corr_axes_foods_thr0.05.txt")
```

Check the number of food items with significant q-values.
```{r}
nrow(subset(dat, Significance=="*"))
```

There are as many as 78 food items at alpha=0.05, so it will be probably better to look at most significant food items or a particular Principal Coordinate Axis of your interest.

Show the first 10  food items that are significantly correlated with one of the axes.
```{r}
head(subset(dat, Significance=="*"), 10)
```

<br>  

---

Come back to the main directory.
```{r, eval=FALSE}
setwd(main_wd)
```

<!-- This is to remove big white space at the end of the rendered html, which is produced due to toc_floating.  Source: https://stackoverflow.com/questions/52933437/how-to-remove-white-space-at-the-end-of-an-rmarkdown-html-output -->
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
