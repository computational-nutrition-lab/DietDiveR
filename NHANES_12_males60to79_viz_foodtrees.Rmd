---
title: "Visualize foodtrees"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 3
# code_folding: hide
---

<style type="text/css">
h1.title {
  font-size: 38px;
  font-family: "Tahoma", sans-serif;
  color: #1F3600; /* darkgreen from DietDiveR logo */
}
h1 { /* Header 1 */
  font-size: 28px;
  color: #1F3600;
}
h2 { /* Header 2 */
    font-size: 22px;
  color: #1F3600;
}
h3 { /* Header 3 */
  font-size: 18px;
  color: #1F3600;
}
body{ /* Normal  */
  background-color: rgb(251, 251, 251);
  }
blockquote{ 
  font-size: 14px;
}
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    background-color: #1F3600;
}
<!-- .navbar { -->
<!--   background-color: #882345; -->
<!--   padding-top: 0rem; -->
<!--   padding-bottom: 0rem; -->
<!-- } -->
</style>

<br>

# Introduction

Here, we will use the ggtree package to plot foodtrees generated in the previous script.

<br>

# Load functions and packages  

Name the path to DietDiveR directory where input files are pulled.
```{r}
main_wd <- "~/GitHub/DietDiveR"
```

If you have not downloaded and installed the ggtree package yet, you can do so by first installing BiocManager (if you have not done so):
```{r}
if (!require("BiocManager", quietly = TRUE))install.packages("BiocManager")
```

Then, use BiocManager to install the "ggtree" package.
```{r,eval=FALSE}
BiocManager::install("ggtree")
```

Load necessary packages.
```{r}
library(ggtree)
```

Load the necessary functions.
```{r}
source("lib/specify_data_dir.R")
source("lib/viz_food_tree.R")
```

You can come back to the main directory by:
```{r, eval=FALSE}
setwd(main_wd)
```

<br>

# Visualize your food tree
  
Specify where your data is.
```{r,eval=FALSE}
SpecifyDataDirectory("eg_data/NHANES/Laboratory_data/Foodtree")
```

<!-- This is the R-markdown code to change directories. -->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_knit$set(root.dir = 'eg_data/NHANES/Laboratory_data/Foodtree')
```

Load your tree object.
```{r}
tree <- read.tree("Food_D12_FC_QC_demo_QCed_males60to79_3Lv.nwk") 
```

It is OK to see an error that says:  
Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'  
Also defined by 'tidytree'  

Prepare the tree data for visualization.
```{r}
PrepFoodTreePlots(input.tree = tree)
```

Create a color-coded and annotated food tree with 9 L1 levels.  
It is OK to see some warning messages that say:  
Coordinate system already present. Adding new coordinate system, which will replace the existing one.  
Scale for 'y' is already present. Adding another scale for 'y', which will replace the existing scale.  
```{r}
VizFoodTree(input.tree=tree, layout="circular")  
```

Take a look at the tree.
```{r message=FALSE, warning=FALSE}
annotated_tree
```

Save.
```{r message=FALSE, warning=FALSE}
ggsave("Food_D12_FC_QC_demo_QCed_males60to79_3Lv_viz.pdf", annotated_tree,
       device="pdf", width=5.2, height=5)
```

You can also visualize trees of different levels; Lv2, Lv3, etc., which corresponds to the classification depth of each food item in the dataset. For example, Lv3 contains L1, L2, and L3 categories of food; whereas Lv4 contains L1, L2, L3, and L4 categories. Thus, as the level goes deeper, the more internal nodes there will be in the foodtree.  


<br>  

---

Come back to the main directory.
```{r, eval=FALSE}
setwd(main_wd)
```

<!-- This is to remove big white space at the end of the rendered html, which is produced due to toc_floating.  Source: https://stackoverflow.com/questions/52933437/how-to-remove-white-space-at-the-end-of-an-rmarkdown-html-output -->
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
