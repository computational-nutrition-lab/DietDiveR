---
title: "Visualize foodtrees"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 3
# code_folding: hide
---

<style type="text/css">
h1.title {
  font-size: 38px;
  font-family: "Tahoma", sans-serif;
  color: #1F3600; /* darkgreen from DietDiveR logo */
}
h1 { /* Header 1 */
  font-size: 28px;
  color: #1F3600;
}
h2 { /* Header 2 */
    font-size: 22px;
  color: #1F3600;
}
h3 { /* Header 3 */
  font-size: 18px;
  color: #1F3600;
}
body{ /* Normal  */
  background-color: rgb(251, 251, 251);
  }
blockquote{ 
  font-size: 14px;
}
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    background-color: #1F3600;
}
<!-- .navbar { -->
<!--   background-color: #882345; -->
<!--   padding-top: 0rem; -->
<!--   padding-bottom: 0rem; -->
<!-- } -->
</style>

<br>

# Introduction

You can plot foodtrees you generated by using the “ggtree” package.  

<br>

# Load the packages/scripts necessary for tree visualization

Name your main directory for future use.
```{r}
main_wd <- "~/GitHub/DietDiveR"
```

<br>

If you have not downloaded and installed the ggtree package yet, you can do so by first installing BiocManager (if you have not done so):
```{r}
if (!require("BiocManager", quietly = TRUE))install.packages("BiocManager")
```

Then, use BiocManager to install the "ggtree" package.
```{r,eval=FALSE}
BiocManager::install("ggtree")
```

Load the packages and functions.
```{r}
library(ggtree)
```

```{r}
source("lib/specify_data_dir.R")
source("lib/viz_food_tree.r")
```

<br>

You can come back to the main directory by:
```{r, eval=FALSE}
setwd(main_wd)
```

Go to the "Foodtree" directory where the tree files are saved.
```{r,eval=FALSE}
SpecifyDataDirectory(directory.name = "eg_data/VVKAJ/Foodtree")
```

<!-- This is the R-markdown code to change directories. -->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_knit$set(root.dir = 'eg_data/VVKAJ/Foodtree/')
```


<br>

# Plot foodtrees

Load the generated foodtree. This will load the .nwk file and save it as a tree object called "tree".  
It is OK to see a message saying:  
Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'  
Also defined by 'tidytree'
```{r}
tree <- read.tree("VVKAJ_Items_f_id_s_m_QCed_4Lv.tree.nwk")
```

Prepare node labels of L1 for plotting. It assumes that the tree file has nine L1 levels.
```{r}
PrepFoodTreePlots(input.tree=tree)
```

<br>

---

Create a color-coded and annotated foodtree with nine L1 levels.  

It is OK to see some warning messages about Coordinate system and scale for 'y' already being present.
```{r}
VizFoodTree(input.tree=tree, layout="circular")
```

Look at the color-coded and annotated foodtree, saved as annotated_tree.
```{r message=FALSE, warning=FALSE}
annotated_tree
```

Save the tree as a PDF file.
```{r message=FALSE, warning=FALSE}
ggsave("VVKAJ_Items_f_id_s_m_QCed_4Lv.tree.pdf",
       annotated_tree, device="pdf", width=6, height=6, units="in", dpi=300)
```

You can also visualize trees of different levels; Lv2, Lv3, etc., which corresponds to the classification depth of each food item in the dataset. For example, Lv3 contains L1, L2, and L3 categories of food; whereas Lv4 contains L1, L2, L3, and L4 categories. Thus, as the level goes deeper, the more internal nodes there will be in the foodtree.

<br>  

---

Come back to the main directory before you start running another script.
```{r, eval=FALSE}
  setwd(main_wd)
```

<!-- This is to remove big white space at the end of the rendered html, which is produced due to toc_floating.  Source: https://stackoverflow.com/questions/52933437/how-to-remove-white-space-at-the-end-of-an-rmarkdown-html-output -->
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
